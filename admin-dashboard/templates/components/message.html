{{define "message"}}
<div class="message {{if .IsPreview}}preview{{else}}bubble{{end}} {{.Source}}-message">
    <div class="flex items-center {{if not .IsPreview}}max-w-[85%]{{end}} {{if .IsOutgoing}}justify-end ml-auto{{end}}">
        {{template "profile-picture" .}}
        <div class="message-content {{.GetMessageStyle}}">
            {{if .IsPreview}}
                {{template "message-preview-content" .}}
            {{else}}
                {{template "message-bubble-content" .}}
            {{end}}
        </div>
    </div>
</div>
{{end}}

{{define "profile-picture"}}
<div class="profile-picture {{if .Size}}h-{{.Size}} w-{{.Size}}{{else}}h-8 w-8{{end}} rounded-full bg-gray-200 overflow-hidden">
    <img src="{{.ProfilePictureURL}}" 
         alt="Profile Picture" 
         onerror="this.onerror=null;this.src='/static/default-avatar.png';">
</div>
{{end}} 