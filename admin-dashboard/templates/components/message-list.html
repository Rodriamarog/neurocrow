{{define "message-list"}}
<div class="divide-y overflow-x-hidden">
    {{range .Messages}}
    <!-- Conversation container -->
    <div class="p-4 hover:bg-gray-50 active:bg-gray-100 cursor-pointer"
         id="thread-preview-{{.ThreadID}}"
         hx-get="/chat?thread_id={{.ThreadID}}"
         hx-target="#chat-view"
         hx-trigger="click"
         _="on htmx:afterOnLoad remove .hidden from #chat-view then remove .translate-x-full from #chat-view">
        <div class="flex items-center justify-between mb-1">
            <div class="flex items-center">
                <div class="w-2 h-2 {{if eq .Platform "facebook"}}bg-blue-500{{else}}bg-pink-500{{end}} rounded-full mr-2"></div>
                <span class="text-sm font-medium {{if eq .Platform "facebook"}}text-blue-600{{else}}text-pink-600{{end}}">
                    {{if eq .Platform "facebook"}}Facebook{{else}}Instagram{{end}}
                </span>
            </div>
            <div class="flex items-center space-x-3">
                <!-- Toggle button: stops event to avoid opening chat -->
                <button
                    class="relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-indigo-600 focus:ring-offset-2 {{if .BotEnabled}}bg-indigo-600{{else}}bg-gray-200{{end}}"
                    role="switch"
                    hx-post="/toggle-bot"
                    hx-vals='{"thread_id": "{{.ThreadID}}", "enabled": "{{not .BotEnabled}}"}'
                    hx-swap="none"
                    _="on click
                          halt the event
                          preventDefault(event)
                          stopPropagation(event)
                          toggle .bg-indigo-600 .bg-gray-200 on me
                          toggle .translate-x-5 .translate-x-0 on #toggle-button-{{.ThreadID}}"
                    aria-checked="{{.BotEnabled}}"
                >
                    <span class="sr-only">Toggle bot</span>
                    <span
                        id="toggle-button-{{.ThreadID}}"
                        aria-hidden="true"
                        class="pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out {{if .BotEnabled}}translate-x-5{{else}}translate-x-0{{end}}"
                    ></span>
                </button>
                <span class="text-xs text-gray-500">{{.Timestamp.Format "15:04"}}</span>
            </div>
        </div>
        <div class="flex items-center">
            <div class="h-12 w-12 rounded-full overflow-hidden bg-gray-200 flex-shrink-0">
                <img src="{{if .ProfilePictureURL.Valid}}{{.ProfilePictureURL.String}}{{else}}/path/to/default-avatar.png{{end}}"
                     alt="Avatar"
                     class="w-full h-full object-cover">
            </div>
            <div class="ml-3 flex-1 overflow-hidden">
                <div class="text-sm font-medium text-gray-900">{{.FromUser}}</div>
                <div class="text-sm text-gray-500 truncate overflow-hidden whitespace-nowrap">{{.Content}}</div>
            </div>
        </div>
    </div>
    {{end}}
</div>
{{end}}